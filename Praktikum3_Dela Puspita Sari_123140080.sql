CREATE TABLE fasilitas_publik (
    id SERIAL PRIMARY KEY,
    nama VARCHAR(100) NOT NULL,
    jenis VARCHAR(50),
    alamat TEXT,
    geom GEOMETRY(Point, 4326)
);
INSERT INTO fasilitas_publik (nama, jenis, alamat, geom) VALUES
(
    'musholla nurul iman', 
    'Fasilitas Umum', 
    'Jalan Perum Pondok Timur, Jatimulyo, Kec. Jati Agung, Kota Bandar Lampung, Lampung', 
    ST_SetSRID(ST_MakePoint(105.31503955583739, -5.336917274983146), 4326)
),
(
    'Gereja Katolik Santo Fransiskus Xaverius, Stasi Jatimulyo', 
    'Fasilitas Umum', 
    'Jatimulyo, Kec. Jati Agung, Kabupaten Lampung Selatan, Lampung', 
    ST_SetSRID(ST_MakePoint(105.31562467086299, -5.337184907987545), 4326)
),
(
    'RAINBOW 99', 
    'Fasilitas Umum', 
    'sidodadi 2 umbul natar , RT/RW.038/013, Jatimulyo, Kec. Jati Agung, Kabupaten Lampung Selatan, Lampung', 
    ST_SetSRID(ST_MakePoint(105.31192110229959, -5.331177388431725), 4326)
),
(
    'Pemancingan Sultan 99', 
    'Fasilitas Umum', 
    'Jatimulyo, Kec. Jati Agung, Kabupaten Lampung Selatan, Lampung', 
    ST_SetSRID(ST_MakePoint(105.31590117104852, -5.338450836223615), 4326)
),
(
    'SDN 3 Jatimulyo', 
    'Sekolah', 
    'Jl. Gadjah Mada No.50, Jatimulyo, Kec. Jati Agung, Kabupaten Lampung Selatan, Lampung', 
    ST_SetSRID(ST_MakePoint(105.31115449909449, -5.33043185175772), 4326)
);

SELECT id, nama, jenis, ST_AsText(geom) as koordinat FROM fasilitas_publik;

CREATE TABLE jalan (
    id SERIAL PRIMARY KEY,
    nama VARCHAR(100),
    geom GEOMETRY(LineString, 4326)
);

INSERT INTO jalan (nama, geom) VALUES
('Jl. Gadjah Mada', ST_GeomFromText('LINESTRING(105.3008615058099 -5.333111782866447, 105.31050823197008 -5.330128158469975)', 4326)),
('Jl. Wakidi', ST_GeomFromText('LINESTRING(105.31359754845026 -5.332855986167062,  105.3150281551626 -5.337104054267093, 105.3158474864595 -5.3369053929805315, 105.31580339270835 -5.337364483777985, 105.31589140027452 -5.338408845512424, 105.31599276578868 -5.338628931872186, 105.31604665646095 -5.33891254687406 )', 4326)),
('Jl. Tol Bakauheni-Terbanggi Besar', ST_GeomFromText('LINESTRING(
105.29309262123321 -5.3319923933767415, 105.31237347236268 -5.341782900494324, 105.31783584683608 -5.345513063888849)', 4326));


CREATE TABLE wilayah_1 (
    id SERIAL PRIMARY KEY,
    nama VARCHAR(100),
    geom GEOMETRY(Polygon, 4326)
);

INSERT INTO wilayah_1 (nama, geom) VALUES
('JatiMulyo', ST_GeomFromText('POLYGON((105.30075155378967 -5.335516984708079, 105.30576830887429 -5.336487754485864, 105.30673315395623 -5.3356906080043025, 105.30759535589266 -5.334157631125786, 105.3108594061043 -5.330682869309382, 105.31393869877608 -5.3290476804565285, 105.31418504215603 -5.328168764671305, 105.31400028459822 -5.327208087839366, 105.32327921972356 -5.324407808504985, 105.3219207810657 -5.3207825942592, 105.31890666201167 -5.319790093251926, 105.29009455977939 -5.33054698727675, 105.30075155378967 -5.335516984708079))', 4326));

SELECT 
    nama, 
    ST_AsText(geom) as wkt, 
	
    ST_AsGeoJSON(geom) as geojson, 
    ST_IsValid(geom) as is_valid 
FROM wilayah_1;


CREATE TABLE wilayah_2 (
    id SERIAL PRIMARY KEY,
    nama VARCHAR(100),
    geom GEOMETRY(Polygon, 4326)
);

INSERT INTO wilayah_2 (nama, geom) VALUES
('Margodadi', ST_GeomFromText('POLYGON((105.37570881221187 -5.299799252104372, 105.37301989766189 -5.300064990938413, 105.37238153192405 -5.30029734539902, 105.37244057532133 -5.303271812992609, 105.36838772578247 -5.304454207200179, 105.36838504356882 -5.302258869417902, 105.36800148768431 -5.302488552322027, 105.36648872180356 -5.303020027555406, 105.36203893704625 -5.302950588603371, 105.36074611229054 -5.303148222517107, 105.35956057591038 -5.303393929452484, 105.3555801777368 -5.304072293758342, 105.35547020716551 -5.304291293106049, 105.35539242310584 -5.305575909618433, 105.35455289168203 -5.305664043299708, 105.3548158885165 -5.310339517655114, 105.35371317672033 -5.31044344150606, 105.35371198193205 -5.310949046832587, 105.35372751418002 -5.310951426150788, 105.3538080981382 -5.312688963592034, 105.35250117948385 -5.312970596611844, 105.35221863240105 -5.31635203720846, 105.35222135623688 -5.318033187449014, 105.35278392724813 -5.319437327365982, 105.35259806179481 -5.321117567323873, 105.35248000116614 -5.321384507938095, 105.35336783183884 -5.323338510875291, 105.35508344401741 -5.325171312120224, 105.35703164120112 -5.326608143426779, 105.36186798731654 -5.326867235319931, 
105.36813925023459 -5.32633768263326, 105.36807474767664 -5.325748656119392, 105.36970731307466 -5.324374614542175, 105.371080051361 -5.320178633383716, 105.3718655998413 -5.3201124851502435, 105.37199129499923 -5.3150034224562335, 105.37166370766374 -5.313828735463777, 105.37172759606393 -5.3109409203716265, 105.37198844495568 -5.309893723237255, 105.37224867248544 -5.309240500043955, 105.37322704784286 -5.307865079056026, 105.37440497892692 -5.306744480659406, 105.37543335390195 -5.306582294348768, 105.37570881221187 -5.299799252104372))', 4326));

SELECT 
    nama, 
    ST_AsText(geom) as wkt, 
	
    ST_AsGeoJSON(geom) as geojson, 
    ST_IsValid(geom) as is_valid 
FROM wilayah_2;


CREATE TABLE wilayah_3 (
    id SERIAL PRIMARY KEY,
    nama VARCHAR(100),
    geom GEOMETRY(Polygon, 4326)
);

INSERT INTO wilayah_3 (nama, geom) VALUES
('Margo Lestari', ST_GeomFromText('POLYGON((105.33342267891167 -5.293397139942357, 105.33342267891219 -5.304459848817323, 105.33670075526075 -5.307475977849086, 105.34509946406571 -5.307270851844328, 105.34604419443693 -5.311170169057521, 105.34597741659098 -5.311195742574755, 105.34651134575931 -5.314368627942274, 105.34726149157812 -5.323308784888481, 105.3491386570899 -5.323651284862102, 105.35166485418145 -5.3231732014208015, 105.35258968104834 -5.321130087999475, 105.35278276091593 -5.319438370640906, 105.35222004875615 -5.318041127344246, 105.35221657522877 -5.316339505156383, 105.35247486506775 -5.3129865856674545, 105.35379359832288 -5.312683569988488, 105.35371469975206 -5.310461450456582, 105.35481927974354 -5.31033799913657, 105.35454903571828 -5.305671344159497, 105.3553830621301 -5.305559120762632, 105.3554732271476 -5.304077770010955, 105.35284717101308 -5.304930669362902, 105.35228363965373 -5.304919447010661, 105.35201314460126 -5.303617652765825, 105.35188916770221 -5.3012609493038925, 105.35294795156953 -5.299205031569499, 105.35304495051126 -5.2959244218579755, 105.35096444202293 -5.295083417173789, 105.35088224187622 -5.2952041864405475, 105.3484705466993 -5.293116889181916, 105.34407752953726 -5.29273560277169, 105.3407098415266 -5.292934811361446, 105.34006011523864 -5.293417376641707, 105.33845177637595 -5.293316621276012, 105.33342267891167 -5.293397139942357))', 4326)); 

SELECT 
    nama, 
    ST_AsText(geom) as wkt, 
	
    ST_AsGeoJSON(geom) as geojson, 
    ST_IsValid(geom) as is_valid 
FROM wilayah_3;


SELECT
    f_table_name,
    f_geometry_column,
    srid,
    type
FROM geometry_columns
WHERE f_table_name IN ('fasilitas_publik', 'jalan', 'wilayah_1', 'wilayah_2', 'wilayah_3');


SELECT
    nama,
    ST_AsText(geom) AS wgs84,
    ST_AsText(ST_Transform(geom, 32748)) AS utm_48s
FROM fasilitas_publik;


SELECT ST_Distance(a.geom, b.geom) AS jarak
FROM fasilitas_publik a, fasilitas_publik b
WHERE a.nama = 'musholla nurul iman'
AND b.nama = 'Gereja Katolik Santo Fransiskus Xaverius, Stasi Jatimulyo';


SELECT ST_Distance(
    a.geom::geography,
    b.geom::geography
) AS jarak_meter
FROM fasilitas_publik a, fasilitas_publik b
WHERE a.nama = 'musholla nurul iman'
AND b.nama = 'Gereja Katolik Santo Fransiskus Xaverius, Stasi Jatimulyo';


SELECT ST_Distance(
    ST_Transform(a.geom, 32748),
    ST_Transform(b.geom, 32748)
) AS jarak_meter
FROM fasilitas_publik a, fasilitas_publik b
WHERE a.nama = 'musholla nurul iman'
AND b.nama = 'Gereja Katolik Santo Fransiskus Xaverius, Stasi Jatimulyo';


SELECT
    nama,
    ST_Area(ST_Transform(geom, 32748)) AS luas_m2,
    ST_Area(ST_Transform(geom, 32748)) / 10000 AS luas_ha
FROM wilayah_1;


SELECT
    nama,
    ST_Area(ST_Transform(geom, 32748)) AS luas_m2,
    ST_Area(ST_Transform(geom, 32748)) / 10000 AS luas_ha
FROM wilayah_2;


SELECT
    nama,
    ST_Area(ST_Transform(geom, 32748)) AS luas_m2,
    ST_Area(ST_Transform(geom, 32748)) / 10000 AS luas_ha
FROM wilayah_3;
